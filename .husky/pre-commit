# Check if any update_*.sql files in supabase/scripts/ are staged
# Only these files auto-sync to database on commit
STAGED_SQL=$(git diff --cached --name-only --diff-filter=ACM | grep "^supabase/scripts/update_.*\.sql$" || true)

if [ -n "$STAGED_SQL" ]; then
  echo "ğŸ“„ Detected staged SQL scripts - running against database..."

  for file in $STAGED_SQL; do
    script_name=$(basename "$file")
    echo "  â†’ Running: $script_name"

    if ! npm run db:run "$script_name" --silent; then
      echo "âŒ SQL script failed: $script_name"
      echo "   Fix the script and try again."
      exit 1
    fi
  done

  echo "âœ… All SQL scripts executed successfully"
fi
